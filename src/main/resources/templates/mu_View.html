<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
</head>
<script th:if="${session.login eq null}">

    alert('ë¡œê·¸ì¸ ì´í›„ ì´ìš©í•´ì£¼ì„¸ìš”.');
    location.href = "memberLogin";
</script>
<style>
    #modal.modal-overlay {
        width: 100%;
        height: 100%;
        position: absolute;
        left: 0;
        top: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: rgba(255, 255, 255, 0.25);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        backdrop-filter: blur(1.5px);
        -webkit-backdrop-filter: blur(1.5px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        display: none;
    }

    #modal .modal-window {
        background: rgba(69, 139, 197, 0.70);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        backdrop-filter: blur(13.5px);
        -webkit-backdrop-filter: blur(13.5px);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.18);
        width: 400px;
        height: 500px;
        position: relative;
        top: -100px;
        padding: 10px;
        overflow-y: auto;
    }

    #modal .title {
        padding-left: 10px;
        display: inline;
        text-shadow: 1px 1px 2px gray;
        color: white;

    }

    #modal .title h2 {
        display: inline;
    }

    #modal .close-area {
        display: inline;
        float: right;
        padding-right: 10px;
        cursor: pointer;
        text-shadow: 1px 1px 2px gray;
        color: white;
    }

    #modal .content {
        margin-top: 20px;
        padding: 0px 10px;
        text-shadow: 1px 1px 2px gray;
        color: white;

    }
</style>
<body>

<table>
    <caption>ìŒì•… ìƒì„¸ë³´ê¸°</caption>
    <tr>
        <th>ë²ˆí˜¸</th>
        <td><input type="hidden" th:value="${muView.muCode}" th:id="muCode" th:text="${muView.muCode}">

        <td>
    </tr>
    <tr>
        <th>ê°€ìˆ˜</th>

        <td>
            <a th:href="@{boardWriterView(boWriter=${muView.muSinger},mId=${session.login.mId})}"
               th:text="${muView.muSinger}"></a>

        <td>
    </tr>
    <tr>
        <th>ìŒì•…ì´ë¦„</th>
        <td th:text="${muView.muName}">
        <td>
    </tr>
    <tr>
        <th>ìŒì•…ì¥ë¥´</th>
        <td th:text="${muView.muGanre}">
        <td>
    </tr>
    <tr>
        <th>ë“±ë¡ì¼</th>
        <td th:text="${muView.muDate}">
        <td>
    </tr>
    <tr>
        <th>ê°€ì‚¬</th>
        <td th:text="${muView.muLyrics}">
        <td>
    </tr>
    <tr>
        <th>ì¡°íšŒìˆ˜</th>
        <td th:text="${muView.muHit}">
        <td>
    </tr>
    <tr>
    <tr>
        <th>ê°€ê²©</th>
        <td th:text="${muView.muPrice}">
        <td>
    </tr>
    <tr>
        <th>ìŒì•…íŒŒì¼</th>
        <td>
            <audio controls="controls" th:id="audio">
                <source th:src="@{/audio/{mFile}(mFile=${muView.mFile})}" style="width:200px;" type="audio/mpeg">
            </audio>
        <td>
    </tr>
    <tr>
        <th>ì´ë¯¸ì§€</th>
        <td><img th:src="@{/muImage/{muImage}(muImage=${muView.muImage})}" style="width:200px;"/>
        <td>
    </tr>
    <tr>
        <th>ì¢‹ì•„ìš”
            <button th:if="${LikeCheck eq 0}" style="width:30px;" HEIGHT="30"
                    th:id="LikeImg" th:value="Like">ğŸ‘
            </button>
            <button th:if="${LikeCheck eq 1}" style="width:30px;" HEIGHT="30"
                    th:id="LikeImg" th:value="LikeDown">ğŸ‘
            </button>
        </th>
        <td>
            <div th:id="root">
                <button th:type="button" th:text="${list}+'ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤.'" th:id="muLike"></button>
            </div>
        </td>
    </tr>
    <tr>
        <td><a th:href="@{fileModiForm(muCode=${muView.muCode})}">
            <button type="button">ìˆ˜ì •</button>
        </a>
            <a th:href="@{fileDelete(muCode=${muView.muCode})}">
                <button type="button">ì‚­ì œ</button>
            </a></td>
    </tr>

</table>
<div id="container">
    <div id="lorem-ipsum"></div>
</div>
<div id="modal" class="modal-overlay" role="dialog">
    <div class="modal-window">
        <div class="title">
            <h2 id="modalTitle"></h2>
        </div>
        <div class="close-area">X</div>
        <div class="content" id="content">
        </div>
    </div>
</div>


<input th:if="${session.login ne null}" type="hidden" th:value="${session.login.mId}" th:id="mId">


<!--<div>-->
<!--    <div th:each = 'list:${list}'>-->
<!--        <img th:if="${session.login.mId.equals('${list.mulMid}')}" th:src="@{/heart/heart1.png}" style="width:30px;" HEIGHT="30" th:class="Heart"  th:id="LikeImg"/>-->
<!--    </div>-->
<!--</div>-->


<div>
    <textarea rows="5" cols="20" th:id=mcContent></textarea>
    <button th:id="mcCommBtn">ëŒ“ê¸€ ì…ë ¥</button>
</div>
<!--ê·œìµ - ë‚´ê°€ ì‹¤ìˆ˜ë¡œ div ì§€ì› ë˜ ê°™ìŒ. í˜¹ì‹œ ë¨¸ì§€ë•Œ ê³‚ì¹˜ë©´ ë‚´ê°€ ì“´ê±° ì§€ìš°ë©´ ë¨.-->
<div th:id="mucommentArea"></div>


</body>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
        crossorigin="anonymous"></script>
<script th:inline="javascript">


    var loginId = $("#mId").val();
    // var muLike = document.getElementById('muLike');  //ì´ë¯¸ì§€ í´ë¦­ì‹œ í™”ë©´ì— ì¶œë ¥ë˜ëŠ” ìˆ«ì ê°’

    const muCode = document.getElementById('muCode').value; // ìŒì•… ì½”ë“œ ê°’
    //const mId = document.getElementById('mId').value; // ì•„ì´ë”” ê°’

    $(document).ready(function () {

        //ëŒ“ê¸€ div ì‹¤í–‰
        var mcCode = $("#muCode").val();
        $.ajax({
            type: "POST",
            url: "mcList",
            data: {"mcCode": mcCode},
            dataType: "json",
            success: function (list) {
                commentList(list);
                console.log("ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ : " + list);
            },
            error: function () {
                alert('ì‹¤íŒ¨');
            }
        })

        //ëŒ“ê¸€ ë²„íŠ¼ í´ë¦­ ì‹œ ajax ì‹¤í–‰
        $('#mcCommBtn').click(function () {
            if (!loginId) {
                alert('ë¡œê·¸ì¸ ì´í›„ ì‚¬ìš©í•˜ì„¸ìš”!');
                location.href = "memberLogin";
            } else {
                var mcMid = loginId;
                var mcContent = $('#mcContent').val();
                var mcMuNum = $('#muCode').val();

                $.ajax({
                    type: "POST",
                    url: "mcWrite",
                    data: {
                        "mcMid": mcMid,
                        "mcContent": mcContent,
                        "mcMuNum": mcMuNum
                    },
                    datatype: "json",
                    success: function (list) {
                        console.log("ì„±ê³µ" + list);
                        commentList(list);
                        $('#mcContent').val("");
                    },
                    error: function () {
                        alert('ëŒ“ëŒ“ ë¼ìŒ ëŒ“ê¸€ ì•ˆë¨');
                    }

                });
            }
        });

    });

    // ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
    function commentList(list) {
        var output = "";
        console.log("ëŒ“ëŒ“ ë¦¬ìŠ¤íŠ¸" + list);
        output += "<table>";
        output += "<tr>";
        output += "<th>ì‘ì„±ì</th>";
        output += "<th>ë‚´ìš©</th>";
        output += "<th>ì‘ì„±ì¼</th>";
        output += "<th>ìˆ˜ì •</th>";
        output += "<th>ì‚­ì œ</th>";
        output += "</tr>";

        for (var i in list) {
            output += "<tr>";
            output += "<td>" + list[i].mcMid + "</td>";
            output += "<td>" + list[i].mcContent + "</td>";
            output += "<td>" + list[i].mcDate + "</td>";
            output += "<td>" + "</td>";
            if (list[i].mcMid == loginId) {
                output += "<td><button onclick='mcCommentModify(" + list[i].mcCode + "," + list[i].mcMuNum + ")'>ìˆ˜ì •</button></td>";
            } else {
                output += "<td><button disabled>ìˆ˜ì •</button></td>";
            }
            if (list[i].mcMid == loginId || loginId == 'admin') {
                output += "<td><button onclick = 'muCommentDelete(mcCode=" + list[i].mcCode + ",mcMuNum=" + list[i].mcMuNum + ")'>ì‚­ì œ</button></td>";
            } else {
                output += "<td><button disabled>ì‚­ì œ</button></td>";
            }

            output += "</tr>";
        }
        output += "</table>";
        var mucommentArea = document.getElementById('mucommentArea');
        mucommentArea.innerHTML = output;
    }

    function mcCommentModify(mcCode, mcMuNum) {
        var check = confirm('ëŒ“ê¸€ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        var mcContent = $('#mcContent').val();
        if (check) {
            $.ajax({
                type: "POST",
                url: "mcModify",
                data: {
                    "mcCode": mcCode,
                    "mcMuNum": mcMuNum,
                    "mcContent": mcContent
                },
                dataType: "json",
                success: function (list) {
                    commentList(list);
                    $('#mcContent').val(""); //ì‘ì„±í•œ ë‚´ìš© ì„ ëŒ“ê¸€ì…ë ¥ê³¼ ë™ì‹œì— ë‚´ìš©ì„ "";
                },
                error: function () {
                    alert('ëŒ“ê¸€ ìˆ˜ì • ì‹¤íŒ¨');
                }
            });
        }
    }

    function muCommentDelete(mcCode, mcMuNum) {
        var check = confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');

        $.ajax({
            type: "POST",
            url: "mcDelete",
            data: {"mcCode": mcCode, "mcMuNum": mcMuNum},
            dataType: "json",
            success: function (list) {
                commentList(list);
            },
            error: function () {
                alert('ì‚­ì œ ì‹¤íŒ¨');
            }

        });
    }

    //ì¢‹ì•„ìš” ë²„íŠ¼ì„ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
    $("#LikeImg").click(function () {
        var loginId = $("#mId").val();
        const muCode = document.getElementById('muCode').value; // ìŒì•… ì½”ë“œ ê°’
        var LikeImg = $("#LikeImg").val();

        console.log('ì½”ë“œ' + muCode);
        console.log('ì•„ì´ë”” : ' + loginId);
        console.log('LikeImg : ' + LikeImg);

        if ($("#LikeImg").val() == "Like") {
            $.ajax({
                type: "POST",
                url: "LikeUp",
                data: {
                    "mulmuCode": muCode,
                    "mulMid": loginId
                },
                dataType: "json",
                success: function (likeUpCount) {
                    console.log("ì—… : " + likeUpCount)
                    $("#muLike").empty().append(likeUpCount + 'ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤.');
                    $("#LikeImg").attr('value', 'LikeDown');

                },
                error: function () {
                    console.log('ì˜¤íƒ€ê°€ ìˆ¨ì–´ìˆë‹¤.');
                }
            });
        } else {
            $.ajax({
                type: "POST",
                url: "LikeDown",
                data: {
                    "mulmuCode": muCode,
                    "mulMid": loginId
                },
                dataType: "json",
                success: function (likeDownCount) {
                    console.log('ë‹¤ìš´: ' + likeDownCount)
                    $("#muLike").empty().append(likeDownCount + 'ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤.');
                    $("#LikeImg").attr('value', 'Like');
                },
                error: function () {
                    console.log('ì˜¤íƒ€ê°€ ìˆ¨ì–´ìˆë‹¤.!!!');
                }
            });

        }


    });

    $("#muLike").click(function () {
        const muCode = document.getElementById('muCode').value;
        console.log(loginId);
        console.log(muCode);
        $.ajax({
            type: "POST",
            url: "MusicLikeList",
            data: {"mulmuCode": muCode},
            dataType: "json",
            success: function (LikeList) {

                var output = "";
                var output1 = "ì¢‹ì•„ìš”";

                for (var i in LikeList) {
                    if (LikeList.length > 0) {
                        output += "<a href='boardWriterView?boWriter=" + LikeList[i].mId + "'><p><img src='/profile/" + LikeList[i].mProfileName + "' style='width: 30px; height: 30px; border-radius: 70%; overflow: hidden;'>" + LikeList[i].mId + "</p></a>"
                        // <a href='boardWriterView?boWriter="+list[i].boWriter+"&mId="+loginId+"'>" + list[i].boWriter + "</a>
                    }
                }
                const modalContent = document.getElementById("content");
                modalContent.innerHTML = output;

                var modalTitle = document.getElementById("modalTitle");
                modalTitle.innerHTML = output1;

                const modal = document.getElementById("modal")

                modal.style.display = "flex"

                const closeBtn = modal.querySelector(".close-area")
                closeBtn.addEventListener("click", e => {
                    modal.style.display = "none"
                });

                modal.addEventListener("click", e => {
                    const evTarget = e.target
                    if (evTarget.classList.contains("modal-overlay")) {
                        modal.style.display = "none"
                    }
                });

                window.addEventListener("keyup", e => {
                    if (modal.style.display === "flex" && e.key === "Escape") {
                        modal.style.display = "none"
                    }
                });


            },
            error: function () {
                alert('êµ¬ë…ì ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
            }
        });
    });


    // ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
    function commentList(list) {
        var output = "";
        console.log("ëŒ“ëŒ“ ë¦¬ìŠ¤íŠ¸" + list);
        output += "<table>";
        output += "<tr>";
        output += "<th>ì‘ì„±ì</th>";
        output += "<th>ë‚´ìš©</th>";
        output += "<th>ì‘ì„±ì¼</th>";
        output += "<th>ìˆ˜ì •</th>";
        output += "<th>ì‚­ì œ</th>";
        output += "</tr>";

        for (var i in list) {
            output += "<tr>";
            output += "<td>" + list[i].mcMid + "</td>";
            output += "<td>" + list[i].mcContent + "</td>";
            output += "<td>" + list[i].mcDate + "</td>";
            output += "<td>" + "</td>";
            if (list[i].mcMid == loginId) {
                output += "<td><button onclick='mcCommentModify(" + list[i].mcCode + "," + list[i].mcMuNum + ")'>ìˆ˜ì •</button></td>";
            } else {
                output += "<td><button disabled>ìˆ˜ì •</button></td>";
            }
            if (list[i].mcMid == loginId || loginId == 'admin') {
                output += "<td><button onclick = 'muCommentDelete(mcCode=" + list[i].mcCode + ",mcMuNum=" + list[i].mcMuNum + ")'>ì‚­ì œ</button></td>";
            } else {
                output += "<td><button disabled>ì‚­ì œ</button></td>";
            }

            output += "</tr>";
        }
        output += "</table>";
        var mucommentArea = document.getElementById('mucommentArea');
        mucommentArea.innerHTML = output;

    }


    function mcCommentModify(mcCode, mcMuNum) {
        var check = confirm('ëŒ“ê¸€ì„ ìˆ˜ì •í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
        var mcContent = $('#mcContent').val();
        if (check) {
            $.ajax({
                type: "POST",
                url: "mcModify",
                data: {
                    "mcCode": mcCode,
                    "mcMuNum": mcMuNum,
                    "mcContent": mcContent
                },
                dataType: "json",
                success: function (list) {
                    commentList(list);
                    $('#mcContent').val(""); //ì‘ì„±í•œ ë‚´ìš© ì„ ëŒ“ê¸€ì…ë ¥ê³¼ ë™ì‹œì— ë‚´ìš©ì„ "";
                },
                error: function () {
                    alert('ëŒ“ê¸€ ìˆ˜ì • ì‹¤íŒ¨');
                }
            });
        }
    }

    // function muCommentDelete(mcCode, mcMuNum) {
    //     var check = confirm('ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
    //
    //     $.ajax({
    //         type: "POST",
    //         url: "mcDelete",
    //         data: {"mcCode": mcCode, "mcMuNum": mcMuNum},
    //         dataType: "json",
    //         success: function (list) {
    //             commentList(list);
    //         },
    //         error: function () {
    //             alert('ì‚­ì œ ì‹¤íŒ¨');
    //         }
    //
    //     });
    // }
  var audio = document.getElementById("audio"); //ì˜¤ë””ì˜¤ id ê°’ìœ¼ë¡œ ë³€ìˆ˜ ì§€ì •

    audio.addEventListener("play", playList); //ë³€ìˆ˜ audioì— addEventListener ì´ë²¤íŠ¸ë¡œ "play" ë˜ì—ˆì„ ë•Œ 'playList' í•¨ìˆ˜ ì‹¤í–‰

    function playList(){
        var loginId = $("#mId").val();
        const muCode = document.getElementById('muCode').value; // ìŒì•… ì½”ë“œ ê°’

        $.ajax({
            type:"POST",
            url:"MusicPlayList",
            data:{
            "plmuCode":muCode,
                "plMid":loginId
            },
            dataType:"json",
            success:function (playListInsert){

            },
            error:function (){
                
            }
        });

    }

</script>
<script>
    $("#muLike").click(function () {
        $("#modal").fadeIn();
    });

    $("#modal_close_btn").click(function () {
        $("#modal").fadeOut();
    });
</script>


</html>